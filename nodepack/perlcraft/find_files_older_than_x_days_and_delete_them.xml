<node>
  <doctext># Deletes all files older than the number if days input
# Written by Jonathan E. Dyer 4/18/00
# Server varibale is hard coded and named $dir1, b/c this script can be dangerous

# *********************************
# Call Modules
# *********************************

use File::Find;
use File::Copy;
use Getopt::Std;
getopts('d:h');

# *********************************
# Initialize variables
# *********************************

$server='server1';
$dir1='\\\\'.&quot;$server&quot;.'\\e$\\clients';
$out=&quot;c:/$server.txt&quot;;
$agedays=60; #defaults agedays to 60

# *********************************
# Process arguments ([h]elp,[d]ays)
# *********************************

if ($opt_h){
	die &quot;\agecmd.pl -d[days to age]\n&quot;;
}

if ($opt_d){
	if ($opt_d gt 9){ #tests for strings
		die &quot;Error: days option must be a number.  Use agecmd.pl -d[days to age]\n&quot;;
	}else{
	$agedays=$opt_d;
	}
}

# *********************************
# Do date calculations
# *********************************

@xtime=localtime(time);
$day=$xtime[3]+1;
$month=$xtime[4]+1;
$year=$xtime[5]+1900;
$hours=$xtime[2];
$mins=$xtime[1];
$secs=$xtime[0];
$logname='//mfa3e04/e$/'.&quot;ftp$month$day$year$hours$mins$secs&quot;.'.log';

$agesecs=60*60*24*$agedays;	#converts $agedays to seconds
$daysago=time-$agesecs;		#the time stamp of $agedays ago in seconds
$daysago2=localtime($daysago);	#the time stamp of $agedays ago in words - mainly for printing


# *********************************
# Find the files (no dir) on the server
# *********************************

print &quot;finding files to be aged\.\.\.\n&quot;;
find(\&amp;wanted, $dir1);

sub wanted {
	$filesecs = (stat(&quot;$File::Find::dir/$_&quot;))[9]; #GETS THE 9TH ELEMENT OF file STAT - THE MODIFIED TIME
	$filesecs2=localtime($filesecs);
	if ($filesecs&lt;$daysago &amp;&amp; -f){ #-f=regular files, eliminates DIR p.367 
		push (@files,&quot;$File::Find::dir/$_&quot;);
		push (@files,&quot;$filesecs2&quot;);
	}
	print'.';
}

# *********************************
# replace '/' with '\' in file names
# *********************************

foreach (@files){
	s/\//\\/g;
}

# *********************************
# Write to Log
# *********************************

%filehash=@files; #puts the array into a hash for easy printing.  Key=file, Value=date
open OUT, &quot;&gt;$logname&quot; or die &quot;Cannot open $out for write :$!&quot;;
print OUT &quot;FTP server aging log generated by PERL script\n&quot;;
print OUT &quot;Script written by Jonathan E. Dyer on 4/18/00\n&quot;;
print OUT &quot;Files deleted from \\\\$server on &quot;.localtime(time).&quot;\n&quot;;
print OUT &quot;Files deleted before $daysago2\n&quot;;
print OUT &quot;Files were aged $agedays days\n\n&quot;;
print OUT &quot;File Listing:\n\n&quot;;
foreach $filename (sort keys %filehash){
	print OUT &quot;$filename	$filehash{$filename}\n&quot;;
}
close OUT;
#!/usr/bin/perl -w

# *********************************
# Delete files
# *********************************

print &quot;\nDeleting all files before $daysago2&quot;;
unlink %filehash;
print &quot;\nScript complete.&quot;;
</doctext>
  <type_nodetype>121</type_nodetype>
  <node_id>28912</node_id>
  <author_user>21786</author_user>
  <title>Find files older than x days and delete them</title>
  <createtime>2000-08-21 20:42:15</createtime>
  <nodeupdated>2005-08-05 03:31:26</nodeupdated>
</node>
