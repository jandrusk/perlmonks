<node>
  <type_nodetype>4</type_nodetype>
  <node_id>351890</node_id>
  <author_user>929</author_user>
  <title>getnewprivatemessages</title>
  <createtime>2004-05-09 14:49:16</createtime>
  <code>return if $HTMLVARS{default_user} eq (my $uid = getId($USER));

my $newlast = $DB-&gt;sqlSelect('tstamp', 'message', '', 'order by tstamp desc limit 1');
my $oldlast = $VARS-&gt;{lastmessagetime} ||= $newlast;
return unless $newlast &gt; $oldlast;

my $csr = $DB-&gt;sqlSelectMany('*','message',qq[for_user = $USER-&gt;{user_id} and tstamp &gt; $oldlast]); 
# order by tstamp desc&quot;);
return unless $csr;
my @messages;
push @messages, $_ while $_ = $csr-&gt;fetchrow_hashref;

$VARS-&gt;{lastmessagetime} = $newlast;
return @messages;</code>
  <nodeupdated>2005-07-19 18:54:52</nodeupdated>
</node>
